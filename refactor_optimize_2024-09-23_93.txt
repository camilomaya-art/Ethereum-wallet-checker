Refactor: Optimize database queries for product search
